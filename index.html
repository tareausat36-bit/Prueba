<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Work in Progress — Construcción</title>
<style>
  :root{
    --ink:#0b1220;
    --card: rgba(255,255,255,.78);
    --card2: rgba(255,255,255,.62);
    --stroke: rgba(14,24,44,.15);
    --shadow: 0 24px 70px rgba(0,0,0,.18);
    --radius: 24px;

    --accent:#2bd6ff;
    --accent2:#7cff6a;

    /* wood-ish colors (only for planks) */
    --pl1:#b57747;
    --pl2:#d39a62;
    --pl3:#8a532f;
    --pl4:#f2c38a;

    --metal1:#e7edf5;
    --metal2:#9aa6b6;

    --handle1:#b86a2b;
    --handle2:#e1a15b;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    overflow:hidden;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color: var(--ink);
    background:
      radial-gradient(900px 520px at 25% 18%, rgba(255,255,255,.85), transparent 60%),
      radial-gradient(900px 520px at 80% 22%, rgba(255,255,255,.75), transparent 62%),
      linear-gradient(180deg, #8fd5ff 0%, #bfe7ff 38%, #d9f3ff 54%, #b6e7b5 54.2%, #8ad486 78%, #73c26f 100%);
  }

  /* clouds */
  .clouds{
    position:fixed; inset:0;
    pointer-events:none;
    opacity:.55;
    filter: blur(.2px);
    background:
      radial-gradient(180px 70px at 14% 18%, rgba(255,255,255,.65), transparent 70%),
      radial-gradient(220px 80px at 32% 16%, rgba(255,255,255,.55), transparent 72%),
      radial-gradient(260px 90px at 60% 20%, rgba(255,255,255,.60), transparent 72%),
      radial-gradient(200px 76px at 78% 14%, rgba(255,255,255,.55), transparent 72%),
      radial-gradient(280px 92px at 86% 22%, rgba(255,255,255,.60), transparent 74%);
    animation: drift 22s linear infinite;
  }
  @keyframes drift{
    from{ transform: translateX(0) }
    to{ transform: translateX(-140px) }
  }

  /* subtle “sun glow” */
  .sun{
    position:fixed;
    width: 420px; height: 420px;
    border-radius: 50%;
    right: -140px; top: -140px;
    background: radial-gradient(circle at 35% 35%, rgba(255,240,170,.92), rgba(255,240,170,.35) 35%, transparent 68%);
    filter: blur(1px);
    opacity:.75;
    pointer-events:none;
  }

  .wrap{
    position:fixed; inset:0;
    display:grid;
    place-items:center;
    padding: 22px;
  }

  .card{
    width:min(980px, 94vw);
    border-radius: var(--radius);
    background: linear-gradient(180deg, var(--card), var(--card2));
    border: 1px solid var(--stroke);
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
    overflow:hidden;
    position:relative;
  }

  .header{
  padding: 22px 22px 12px;
  display:grid;
  grid-template-columns: 1fr auto;
  align-items:end;
  gap:14px;
}

.header > div:first-child{
  text-align:center;
}

.header > div:first-child h1{
  margin:0;
  text-align:center;
}

.header > div:first-child .sub{
  margin: 8px auto 0;
  text-align:center;
}

  h1{
    margin:0;
    letter-spacing:.16em;
    text-transform:uppercase;
    font-size: clamp(28px, 4.4vw, 56px);
  }
  .sub{
    margin: 8px 0 0;
    color: rgba(11,18,32,.72);
    max-width: 75ch;
    line-height:1.35;
    font-size: clamp(14px, 1.6vw, 16px);
  }

  .badge{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding: 10px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,.55);
    border: 1px solid rgba(14,24,44,.12);
    box-shadow: 0 10px 24px rgba(0,0,0,.08);
    font-size: 12px;
    letter-spacing:.10em;
    text-transform:uppercase;
    color: rgba(11,18,32,.78);
  }
  .badge .dot{
    width:9px; height:9px; border-radius:50%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    box-shadow: 0 0 16px rgba(43,214,255,.30);
    animation: pulse 2.2s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,45%{ transform: scale(.9); opacity:.7 }
    70%{ transform: scale(1.15); opacity:1 }
    100%{ transform: scale(.95); opacity:.8 }
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    padding: 0 22px 22px;
    align-items:stretch;
  }

  /* ===== PROGRESS ===== */
  .progressBox{
    border-radius: 18px;
    background: rgba(255,255,255,.52);
    border: 1px solid rgba(14,24,44,.12);
    padding: 16px 16px 14px;
    box-shadow: 0 16px 32px rgba(0,0,0,.08);
  }
  .prow{
    display:flex;
    justify-content:space-between;
    align-items:baseline;
    gap: 12px;
  }
  .label{
    letter-spacing:.12em;
    text-transform:uppercase;
    font-size: 12px;
    color: rgba(11,18,32,.70);
  }
  .pct{
    font-variant-numeric: tabular-nums;
    font-weight: 900;
    letter-spacing:.08em;
    color: rgba(11,18,32,.88);
  }

  .bar{
    margin-top: 12px;
    height: 16px;
    border-radius: 999px;
    background: rgba(11,18,32,.08);
    border: 1px solid rgba(14,24,44,.12);
    overflow:hidden;
    position:relative;
  }
  .fill{
    height:100%;
    width:30%;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    box-shadow: 0 0 18px rgba(43,214,255,.18);
    transition: width .12s linear; /* will be toggled to snap during reset */
  }
  .bar::after{
    content:"";
    position:absolute;
    inset:-60% -40%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.36), transparent);
    transform: translateX(-60%);
    animation: shine 1.35s linear infinite;
    opacity:.55;
    pointer-events:none;
  }
  @keyframes shine{
    from{ transform: translateX(-65%) }
    to{ transform: translateX(65%) }
  }

  .status{
    margin-top: 10px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    font-size: 12px;
    color: rgba(11,18,32,.68);
  }
  .status .hint{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 8px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,.45);
    border: 1px solid rgba(14,24,44,.10);
  }
  .status .hint i{
    width:8px; height:8px; border-radius:50%;
    background: rgba(11,18,32,.65);
    display:inline-block;
  }

  /* ===== BUILD WINDOW ===== */
  .buildBox{
    border-radius: 18px;
    background: rgba(255,255,255,.52);
    border: 1px solid rgba(14,24,44,.12);
    box-shadow: 0 16px 32px rgba(0,0,0,.08);
    position:relative;
    overflow:hidden;
    min-height: 292px;
    cursor: pointer;
    user-select:none;
  }

  .buildBox:focus{ outline: 3px solid rgba(43,214,255,.35); outline-offset: 3px; }
  .buildTop{
    padding: 14px 16px 0;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .buildTitle{
    font-size: 12px;
    letter-spacing:.12em;
    text-transform:uppercase;
    color: rgba(11,18,32,.70);
  }
  .tap{
    font-size: 12px;
    color: rgba(11,18,32,.62);
    padding: 7px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,.40);
    border: 1px solid rgba(14,24,44,.10);
  }

  /* “window” scene area */
  .scene{
    position:relative;
    height: 250px;
    margin: 10px 12px 12px;
    border-radius: 16px;
    background:
      radial-gradient(600px 260px at 50% 30%, rgba(255,255,255,.85), transparent 62%),
      linear-gradient(180deg, rgba(143,213,255,.38), rgba(191,231,255,.25) 55%, rgba(182,231,181,.20) 55.2%, rgba(138,212,134,.20));
    border: 1px solid rgba(14,24,44,.12);
    overflow:hidden;
  }

  /* ground inside the window */
  .ground{
    position:absolute;
    left:-10%;
    right:-10%;
    bottom:-10px;
    height: 86px;
    background:
      radial-gradient(120px 40px at 12% 40%, rgba(255,255,255,.22), transparent 70%),
      radial-gradient(160px 50px at 65% 45%, rgba(255,255,255,.16), transparent 72%),
      linear-gradient(180deg, rgba(30,120,60,.00), rgba(26,106,54,.18)),
      linear-gradient(90deg, rgba(80,180,90,.55), rgba(100,210,110,.45));
    border-top: 1px solid rgba(14,24,44,.10);
    filter: saturate(1.05);
  }

  /* planks group */
  .pile{
    position:absolute;
    left:50%;
    bottom: 36px;
    width: 320px;
    height: 150px;
    transform: translateX(-50%);
    pointer-events:none;
  }

  .plank{
    position:absolute;
    left:50%;
    top: 70px;
    width: 250px;
    height: 18px;
    border-radius: 12px;
    border: 1px solid rgba(14,24,44,.12);
    background:
      repeating-linear-gradient(90deg, rgba(0,0,0,.10) 0 12px, rgba(0,0,0,0) 18px),
      linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.16)),
      linear-gradient(90deg, var(--pl1), var(--pl2));
    box-shadow: 0 18px 24px rgba(0,0,0,.16);
    transform-origin: 50% 50%;
    transform: translateX(-50%) rotate(var(--r0)) translate(var(--x0), var(--y0));
    transition:
      transform 560ms cubic-bezier(.2,.9,.2,1),
      opacity 420ms ease;
    opacity: 1;
  }
  .plank.p2{ width: 270px; height: 18px; background:
      repeating-linear-gradient(90deg, rgba(0,0,0,.12) 0 12px, rgba(0,0,0,0) 18px),
      linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.16)),
      linear-gradient(90deg, var(--pl3), var(--pl4));
  }
  .plank.p3{ width: 230px; height: 17px; filter: saturate(1.06); }
  .plank.p4{ width: 255px; height: 17px; filter: saturate(1.03); }

  /* target “assembled” positions */
  .pile.assembled .plank{
    transform: translateX(-50%) rotate(var(--r1)) translate(var(--x1), var(--y1));
  }

  /* hammer */
  .hammer{
    position:absolute;
    left:50%;
    top: 8px;
    width: 260px;
    height: 190px;
    transform: translateX(-50%);
    transform-origin: 175px 150px;
    pointer-events:none;
  }

  /* hammer swing (speed controlled by CSS var) */
  .hammer{
    animation: swing var(--swingDur, 1.05s) ease-in-out infinite;
    filter: drop-shadow(0 18px 18px rgba(0,0,0,.18));
  }

  @keyframes swing{
    0%   { transform: translateX(-50%) rotate(-26deg) translateY(0); }
    52%  { transform: translateX(-50%) rotate(20deg)  translateY(16px); }
    60%  { transform: translateX(-50%) rotate(14deg)  translateY(20px); }
    100% { transform: translateX(-50%) rotate(-26deg) translateY(0); }
  }

  /* handle */
  .h-handle{
    position:absolute;
    left: 165px;
    top: 44px;
    width: 18px;
    height: 132px;
    border-radius: 12px;
    background:
      repeating-linear-gradient(180deg, rgba(0,0,0,.10) 0 10px, rgba(0,0,0,0) 16px),
      linear-gradient(180deg, rgba(255,255,255,.20), rgba(0,0,0,.18)),
      linear-gradient(90deg, var(--handle1), var(--handle2));
    border: 1px solid rgba(14,24,44,.12);
    box-shadow: inset 0 -12px 18px rgba(0,0,0,.18);
  }
  .h-grip{
    position:absolute;
    left: 160px;
    top: 130px;
    width: 28px;
    height: 60px;
    border-radius: 16px;
    background: rgba(11,18,32,.12);
    border: 1px solid rgba(14,24,44,.12);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.22);
  }

  /* head (nicer) */
  .h-head{
    position:absolute;
    left: 92px;
    top: 26px;
    width: 104px;
    height: 42px;
    border-radius: 16px;
    background:
      radial-gradient(70px 40px at 30% 30%, rgba(255,255,255,.75), transparent 62%),
      linear-gradient(180deg, rgba(255,255,255,.36), rgba(0,0,0,.22)),
      linear-gradient(90deg, var(--metal1), var(--metal2));
    border: 1px solid rgba(14,24,44,.14);
    box-shadow: inset 0 -12px 20px rgba(0,0,0,.22);
  }
  .h-head::before, .h-head::after{
    content:"";
    position:absolute;
    top: 10px;
    width: 30px;
    height: 22px;
    border-radius: 13px;
    background:
      linear-gradient(180deg, rgba(255,255,255,.28), rgba(0,0,0,.22)),
      linear-gradient(90deg, rgba(231,237,245,.78), rgba(154,166,182,.62));
    border: 1px solid rgba(14,24,44,.12);
  }
  .h-head::before{ left:-26px }
  .h-head::after{ right:-26px }

  /* impact effects */
  .impact{
    position:absolute;
    left:50%;
    top: 128px;
    width: 340px;
    height: 120px;
    transform: translateX(-50%);
    pointer-events:none;
  }
  .ring{
    position:absolute;
    left:50%;
    top: 34px;
    width: 54px; height: 54px;
    border-radius:50%;
    border: 2px solid rgba(43,214,255,0);
    transform: translateX(-50%) scale(.6);
    opacity:0;
    animation: ring var(--swingDur, 1.05s) ease-in-out infinite;
  }
  @keyframes ring{
    0%,55%{ opacity:0; border-color:rgba(43,214,255,0); transform:translateX(-50%) scale(.6); }
    62%{ opacity:.9; border-color:rgba(43,214,255,.55); transform:translateX(-50%) scale(1); }
    100%{ opacity:0; border-color:rgba(43,214,255,0); transform:translateX(-50%) scale(1.45); }
  }
  .spark{
    position:absolute;
    left:50%;
    top: 62px;
    width: 7px; height: 5px;
    border-radius:2px;
    opacity:0;
    background: rgba(255,255,255,0);
    transform: translateX(-50%) translate(0,0) rotate(0deg);
    animation: sparks var(--swingDur, 1.05s) ease-in-out infinite;
  }
  .spark.s1{ --dx:-60px; --dy:-22px; --r:-18deg; }
  .spark.s2{ --dx:-36px; --dy:-38px; --r:-34deg; }
  .spark.s3{ --dx: 36px; --dy:-38px; --r: 34deg; }
  .spark.s4{ --dx: 60px; --dy:-22px; --r: 18deg; }
  @keyframes sparks{
    0%,56%{opacity:0; background:rgba(255,255,255,0); transform:translateX(-50%) translate(0,0) rotate(0deg) scale(.85);}
    62%{
      opacity:1;
      background: rgba(255,255,255,.92);
      box-shadow: 0 0 14px rgba(255,255,255,.55);
      transform:translateX(-50%) translate(var(--dx), var(--dy)) rotate(var(--r)) scale(1);
    }
    100%{opacity:0; transform:translateX(-50%) translate(calc(var(--dx)*1.25), calc(var(--dy)*1.25)) rotate(var(--r)) scale(.9);}
  }

  .note{
    position:absolute;
    right: 14px;
    bottom: 12px;
    font-size: 12px;
    color: rgba(11,18,32,.62);
    background: rgba(255,255,255,.45);
    border: 1px solid rgba(14,24,44,.10);
    padding: 8px 10px;
    border-radius: 12px;
  }

  /* responsive */
  @media (max-width:860px){
    .grid{ grid-template-columns: 1fr; }
    .buildBox{ min-height: 300px; }
  }
</style>
</head>

<body>
  <div class="sun"></div>
  <div class="clouds"></div>

  <div class="wrap">
    <div class="card">
      <div class="header">
        <div>
          <h1>WORK IN PROGRESS</h1>
          <div class="sub">Se esta construyendo algo bonito, puedes recordarle al encargado que no lo olvide.</div>
        </div>
        <div class="badge"><span class="dot"></span> Construcción activa</div>
      </div>

      <div class="grid">
        <!-- Progress -->
        <div class="progressBox">
          <div class="prow">
            <div class="label">Progreso</div>
            <div class="pct"><span id="pct">30</span>%</div>
          </div>

          <div class="bar">
            <div class="fill" id="fill"></div>
          </div>

          <div class="status">
            <span class="hint"><i></i> <span id="step">Acomodando materiales…</span></span>
            <span>Ups aún no esta listo</span>
          </div>
        </div>

        <!-- Build Window -->
        <div class="buildBox" id="buildBox" tabindex="0" role="button" aria-label="Ventana de construcción (clic para acelerar)">
          <div class="buildTop">
            <div class="buildTitle">Ventana de construcción</div>
            <div class="tap" id="tapLabel">Clic para acelerar ⚡</div>
          </div>

          <div class="scene" id="scene">
            <div class="hammer" id="hammer" aria-hidden="true">
              <div class="h-head"></div>
              <div class="h-handle"></div>
              <div class="h-grip"></div>
            </div>

            <div class="impact" aria-hidden="true">
              <div class="ring"></div>
              <div class="spark s1"></div><div class="spark s2"></div><div class="spark s3"></div><div class="spark s4"></div>
            </div>

            <div class="pile" id="pile" aria-hidden="true">
              <!-- initial messy pile positions -->
              <div class="plank p1" style="--r0:-28deg;--x0:-18px;--y0:18px; --r1:0deg; --x1:0px; --y1:0px;"></div>
              <div class="plank p2" style="--r0:18deg; --x0:16px; --y0:2px;  --r1:0deg; --x1:0px; --y1:24px;"></div>
              <div class="plank p3" style="--r0:-10deg;--x0:10px; --y0:28px; --r1:0deg; --x1:0px; --y1:48px;"></div>
              <div class="plank p4" style="--r0:30deg; --x0:-6px; --y0:42px; --r1:0deg; --x1:0px; --y1:72px;"></div>
            </div>

            <div class="ground" aria-hidden="true"></div>
          </div>

          <div class="note" id="speedNote">Velocidad: normal</div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===== Behavior requested =====
  // - Progress goes 30% -> 85% smoothly
  // - When reaches 85%, quickly drops to 30% while animation resets to "messy pile"
  // - Then builds again
  // - Clicking build window accelerates hammer+planks+progress coherently

  const MAX = 85;
  const MIN = 30;

  const fill = document.getElementById("fill");
  const pctEl = document.getElementById("pct");
  const stepEl = document.getElementById("step");
  const pile = document.getElementById("pile");
  const box = document.getElementById("buildBox");
  const speedNote = document.getElementById("speedNote");
  const tapLabel = document.getElementById("tapLabel");
  const scene = document.getElementById("scene");

  // Steps text
  const steps = [
    "Acomodando materiales…",
    "Alineando tablones…",
    "Ajustando posición…",
    "Revisando nivel…",
    "Fijando estructura…",
    "Pulido final…",
  ];

  let progress = MIN;
  let state = "build"; // build | resetDrop
  let t = 0;

  // speed multiplier: 1 normal, >1 faster
  let speed = 1;
  let boostUntil = 0;

  // Apply initial width
  function setProgressUI(p, snap=false){
    // snap: disable transition for instant-ish changes
    fill.style.transition = snap ? "none" : "width .12s linear";
    fill.style.width = p + "%";
    pctEl.textContent = Math.round(p);
  }
  setProgressUI(progress, true);

  // plank assemble factor from 0..1
  // At MIN => messy (0), at MAX => assembled (1)
  function setAssembleFactor(p){
    const f = (p - MIN) / (MAX - MIN); // 0..1
    // assembled after about 55% of the range feels nicer
    const eased = Math.max(0, Math.min(1, (f - 0.08) / 0.92));
    if(eased > 0.5){
      pile.classList.add("assembled");
    }else{
      pile.classList.remove("assembled");
    }
    // Also slightly “tighten” the messy pile continuously using CSS variables:
    // We'll interpolate rotation & translation by toggling assembled at midpoint and relying on transition.
    // That already looks like planks being corrected.
  }

  function setSpeed(mult){
    speed = mult;
    // speed also affects hammer ring/sparks by changing CSS custom property
    // shorter duration => faster swing
    const dur = (1.05 / speed).toFixed(3) + "s";
    scene.style.setProperty("--swingDur", dur);
    speedNote.textContent = "Velocidad: " + (speed > 1 ? "rápida ⚡" : "normal");
  }

  setSpeed(1);

  function triggerBoost(){
    // Boost lasts ~3 seconds
    boostUntil = performance.now() + 3000;
    tapLabel.textContent = "¡Acelerado! ⚡";
    setSpeed(2.2);
    // small visual feedback
    box.style.transform = "translateY(-1px)";
    setTimeout(()=> box.style.transform = "", 160);
  }

  box.addEventListener("click", triggerBoost);
  box.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      triggerBoost();
    }
  });

  // main loop
  function loop(now){
    t++;

    // handle boost decay
    if(boostUntil && now > boostUntil){
      boostUntil = 0;
      tapLabel.textContent = "Clic para acelerar ⚡";
      setSpeed(1);
    }

    // change step text occasionally (scaled by speed)
    const stepEvery = Math.round(60 / speed);
    if(t % stepEvery === 0){
      stepEl.textContent = steps[Math.floor(Math.random()*steps.length)];
    }

    if(state === "build"){
      // Build slowly to 85
      // Speed affects how quickly it builds
      const base = 0.12; // base increment per frame (tuned to feel smooth)
      progress += base * speed;

      if(progress >= MAX){
        progress = MAX;
        setProgressUI(progress, false);
        setAssembleFactor(progress);

        // Hold a fraction, then drop quickly to 30 and reset planks
        state = "resetDrop";
        // make drop feel crisp but not jarring
        // We'll do a quick animation by stepping down over a short duration.
        dropStart = now;
      }else{
        setProgressUI(progress, false);
        setAssembleFactor(progress);
      }
    } else if(state === "resetDrop"){
      // Quickly drop to MIN while resetting visual to messy
      // This should look like "new cycle" starting.
      // We'll drop over ~280ms normal, ~200ms fast (scaled).
      const dur = 280 / speed;
      const a = Math.min(1, (now - dropStart) / dur);

      // ease out quickly
      const eased = 1 - Math.pow(1 - a, 3);

      const p = MAX + (MIN - MAX) * eased;
      // During drop, snap a bit more (looks like reset)
      setProgressUI(p, false);

      // Reset planks back to messy right at the start of drop (but smoothly)
      if(!resetDone){
        resetDone = true;
        pile.classList.remove("assembled");
      }

      if(a >= 1){
        progress = MIN;
        // snap to clean baseline
        setProgressUI(progress, true);
        // re-enable transition next tick
        requestAnimationFrame(()=> fill.style.transition = "width .12s linear");

        resetDone = false;
        state = "build";
      }
    }

    requestAnimationFrame(loop);
  }

  let dropStart = 0;
  let resetDone = false;

  requestAnimationFrame(loop);
</script>
</body>
</html>
